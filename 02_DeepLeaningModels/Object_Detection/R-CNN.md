# R-CNN（Region-based Convolutional Neural Networks）

## 概要
R-CNNは、2014年にRoss Girshickによって提案された、物体検出のための先駆的なディープラーニングモデルです。R-CNNは、画像内の物体を高い精度で検出することを目的とし、Selective SearchやCNNによる特徴抽出、SVMによる分類、回帰モデルによる境界ボックス調整などの複数のステップで構成されています。

## R-CNNの主要ステップと構造
R-CNNは以下の主要なステップで構成されます：

### 1. 物体候補領域の生成（Selective Search）
- **概要**: 画像をセグメンテーションし、物体が存在する可能性のある領域（候補領域）を生成するためにSelective Searchアルゴリズムを使用します。
- **動作**: 異なるスケールで画像をセグメント化し、それらを組み合わせて候補領域を生成。効率的に物体候補を抽出することが可能です。
- **出力**: 各候補領域のバウンディングボックス座標。

### 2. CNNによる特徴抽出
- **使用するモデル**: R-CNNは事前学習済みのCNN（例えばVGG16やAlexNet）を使用して、各物体候補領域から特徴を抽出します。
- **特徴ベクトル**: 各候補領域をリサイズし、CNNに通して高次元の特徴ベクトルを取得します。
- **具体的な流れ**:
  1. 各候補領域を224×224にリサイズ。
  2. 正規化し、CNNに入力。
  3. Flattenして1次元の特徴ベクトルを取得。

### 3. SVMによるクラス分類
- **目的**: CNNから抽出した特徴ベクトルを使用して、SVMで各候補領域がどの物体クラスに属するかを分類します。
- **詳細**: 各物体クラスごとに個別のSVMをトレーニングし、候補領域を分類します。
- **分類結果**: 各候補領域に対してクラスラベルとスコアを出力。

### 4. 境界ボックスの調整（回帰モデル）
- **目的**: SVMで分類された候補領域の境界ボックスを、回帰モデルを使用して微調整し、検出精度を向上させます。
- **動作**: 入力された特徴ベクトルを使って、回帰モデルでバウンディングボックスのオフセット（位置とサイズの調整）を予測します。
- **調整結果**: 境界ボックスが調整され、物体の位置をより正確に特定。

## R-CNNの内部構造の詳細
R-CNNは以下の内部構造を持っています：

### 1. **Selective Search**
Selective Searchは、画像内の異なるスケールでの領域を生成し、それらを統合することで物体候補領域を抽出します。各候補領域はバウンディングボックスとして表されます。

### 2. **CNNによる特徴抽出**
事前学習済みのCNN（例：VGG16）の一部（特徴抽出層）を使用します。入力は各候補領域で、出力は高次元の特徴ベクトルです。CNNのアーキテクチャは以下のように構成されます：
- **入力層**: リサイズされた候補領域画像。
- **畳み込み層**: 複数のカーネルで特徴を抽出。
- **プーリング層**: 特徴量を圧縮して計算効率を高める。
- **Flatten**: 特徴マップを1次元のベクトルに変換。

### 3. **SVMによる分類**
抽出された特徴ベクトルをSVMに入力し、各候補領域を特定のクラスに分類します。分類モデルは各クラスごとにトレーニングされ、物体が存在するかどうかを決定します。

### 4. **回帰モデルによる境界ボックス調整**
線形回帰モデルを使用して、候補領域の境界ボックスを微調整します。これにより、候補領域がより正確な位置に配置されます。

## R-CNNのメリットと課題
### メリット
- **高精度**: 従来のスライディングウィンドウ方式に比べ、精度が大幅に向上。
- **モジュール型設計**: 各ステップが独立しているため、各部分を個別に改良可能。

### 課題
- **計算コストが高い**: 各候補領域に対してCNNを適用するため、計算量が多く、処理が遅い。
- **複雑なトレーニング**: CNN、SVM、回帰モデルのトレーニングが個別に行われるため、全体のプロセスが複雑。

## 改良モデル
- **Fast R-CNN**: R-CNNの候補領域を共有し、計算効率を向上。
- **Faster R-CNN**: Region Proposal Network (RPN) を導入し、物体候補領域の生成をCNNで行うことで速度を改善。
- **Mask R-CNN**: Faster R-CNNにセグメンテーションを追加し、物体のマスクを生成可能。

## まとめ
R-CNNは、物体検出の精度を向上させた初のディープラーニングベースのモデルとして知られています。計算コストの高さやトレーニングの複雑さといった課題はありますが、物体検出技術の発展において重要な役割を果たしました。改良版のFast R-CNNやFaster R-CNNの基礎を築いたことでも評価されています。